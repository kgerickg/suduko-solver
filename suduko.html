<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>數獨求解器</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    table { border-collapse: collapse; margin: 20px auto; }
    td { border: 1px solid #666; width: 40px; height: 40px; }
    input {
      width: 38px; height: 38px; 
      text-align: center; font-size: 18px; border: none;
    }
    td:nth-child(3n) { border-right: 2px solid black; }
    tr:nth-child(3n) td { border-bottom: 2px solid black; }
    .btn { padding: 8px 16px; margin: 10px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>數獨求解器</h1>
  <table id="board"></table>
  <button class="btn" onclick="solveSudoku()">解題</button>
  <button class="btn" onclick="clearBoard()">清空</button>

  <script>
    const SIZE = 9;
    const boardElem = document.getElementById("board");

    // 建立數獨盤
    for (let r = 0; r < SIZE; r++) {
      const row = document.createElement("tr");
      for (let c = 0; c < SIZE; c++) {
        const cell = document.createElement("td");
        const input = document.createElement("input");
        input.setAttribute("maxlength", "1");
        cell.appendChild(input);
        row.appendChild(cell);
      }
      boardElem.appendChild(row);
    }

    function getBoard() {
      const board = [];
      const rows = boardElem.getElementsByTagName("tr");
      for (let r = 0; r < SIZE; r++) {
        const cells = rows[r].getElementsByTagName("input");
        const row = [];
        for (let c = 0; c < SIZE; c++) {
          const val = cells[c].value;
          row.push(val === "" ? 0 : parseInt(val));
        }
        board.push(row);
      }
      return board;
    }

    function setBoard(board) {
      const rows = boardElem.getElementsByTagName("tr");
      for (let r = 0; r < SIZE; r++) {
        const cells = rows[r].getElementsByTagName("input");
        for (let c = 0; c < SIZE; c++) {
          cells[c].value = board[r][c] === 0 ? "" : board[r][c];
        }
      }
    }

    function clearBoard() {
      const rows = boardElem.getElementsByTagName("tr");
      for (let r = 0; r < SIZE; r++) {
        const cells = rows[r].getElementsByTagName("input");
        for (let c = 0; c < SIZE; c++) {
          cells[c].value = "";
        }
      }
    }

    function solveSudoku() {
      const board = getBoard();
      if (solve(board, 0, 0)) {
        setBoard(board);
      } else {
        alert("無解！");
      }
    }

    function solve(board, row, col) {
      if (row === SIZE) return true;
      let nextRow = (col === SIZE - 1) ? row + 1 : row;
      let nextCol = (col === SIZE - 1) ? 0 : col + 1;

      if (board[row][col] !== 0) {
        return solve(board, nextRow, nextCol);
      }

      for (let num = 1; num <= 9; num++) {
        if (isValid(board, row, col, num)) {
          board[row][col] = num;
          if (solve(board, nextRow, nextCol)) return true;
          board[row][col] = 0;
        }
      }
      return false;
    }

    function isValid(board, row, col, num) {
      for (let i = 0; i < SIZE; i++) {
        if (board[row][i] === num || board[i][col] === num) return false;
      }
      const startRow = Math.floor(row / 3) * 3;
      const startCol = Math.floor(col / 3) * 3;
      for (let r = 0; r < 3; r++) {
        for (let c = 0; c < 3; c++) {
          if (board[startRow + r][startCol + c] === num) return false;
        }
      }
      return true;
    }
  </script>
</body>
</html>
